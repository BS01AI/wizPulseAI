# WizPulseAI æœ¬åœ°æµ‹è¯•æŒ‡å—

> æœ€åæ›´æ–°: 2025-10-29
> çŠ¶æ€: âœ… é…ç½®å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¯å¢ƒé…ç½®ç¡®è®¤

æ‰€æœ‰3ä¸ªç«™ç‚¹çš„é…ç½®å·²å®Œæˆï¼š

| ç«™ç‚¹ | ç›®å½• | ç«¯å£ | é…ç½®çŠ¶æ€ |
|------|------|------|---------|
| ğŸ” Auth | `auth-wizpulseai-com` | 3001 | âœ… å·²é…ç½® |
| ğŸ“Š Dashboard | `db-wizPulseAI-com` | 3002 | âœ… å·²é…ç½® |
| ğŸŒ Main | `wizPulseAI-com` | 3000 | âœ… å·²é…ç½® |

**å…±äº« Supabase é¡¹ç›®**: `lhofjwiqjqjtycnhliga`

### 2. æœ¬åœ°å¼€å‘ Cookie é…ç½®

```bash
# 3ä¸ªç«™ç‚¹ç»Ÿä¸€ä½¿ç”¨ .localhost åŸŸ
NEXT_PUBLIC_COOKIE_DOMAIN=.localhost

# è¿™æ ·å¯ä»¥åœ¨æœ¬åœ°å®ç°è·¨ç«™ç‚¹çš„SSO
# è®¿é—®åœ°å€éœ€è¦ç”¨åŸŸåå½¢å¼ï¼š
# - http://auth.localhost:3001
# - http://dashboard.localhost:3002
# - http://www.localhost:3000
```

---

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ–¹å¼1: æ‰‹åŠ¨å¯åŠ¨ï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰

æ‰“å¼€3ä¸ªç»ˆç«¯çª—å£ï¼Œåˆ†åˆ«è¿è¡Œï¼š

```bash
# Terminal 1 - Auth ç«™ç‚¹ (ç«¯å£ 3001)
cd auth-wizpulseai-com
npm run dev -- -p 3001

# Terminal 2 - Dashboard ç«™ç‚¹ (ç«¯å£ 3002)
cd db-wizPulseAI-com
npm run dev -- -p 3002

# Terminal 3 - Main ç«™ç‚¹ (ç«¯å£ 3000)
cd wizPulseAI-com
npm run dev
```

### æ–¹å¼2: ä½¿ç”¨ Tmux/å¹¶è¡Œè„šæœ¬

åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ `start-all.sh`:

```bash
#!/bin/bash

echo "ğŸš€ å¯åŠ¨ WizPulseAI ä¸‰ç«™ç‚¹..."

# å¯åŠ¨ Auth ç«™ç‚¹
cd auth-wizpulseai-com
npm run dev -- -p 3001 &
AUTH_PID=$!

# å¯åŠ¨ Dashboard ç«™ç‚¹
cd ../db-wizPulseAI-com
npm run dev -- -p 3002 &
DASH_PID=$!

# å¯åŠ¨ Main ç«™ç‚¹
cd ../wizPulseAI-com
npm run dev &
MAIN_PID=$!

echo "âœ… æ‰€æœ‰ç«™ç‚¹å¯åŠ¨å®Œæˆ"
echo "Auth PID: $AUTH_PID"
echo "Dashboard PID: $DASH_PID"
echo "Main PID: $MAIN_PID"

# ç­‰å¾…æ‰€æœ‰è¿›ç¨‹
wait
```

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### é˜¶æ®µ1: ç‹¬ç«‹ç«™ç‚¹æµ‹è¯•

#### 1.1 Main ç«™ç‚¹ (www)
```bash
# è®¿é—®åœ°å€
http://localhost:3000
# æˆ–
http://www.localhost:3000

# æµ‹è¯•ç‚¹ï¼š
âœ… é¦–é¡µåŠ è½½æ­£å¸¸
âœ… äº§å“å±•ç¤ºé¡µé¢
âœ… 3D åŠ¨ç”»æ•ˆæœ
âœ… çŸ¥è¯†ä¸­å¿ƒæ–‡ç« 
âœ… å¤šè¯­è¨€åˆ‡æ¢ (ja/zh/en)
```

#### 1.2 Auth ç«™ç‚¹
```bash
# è®¿é—®åœ°å€
http://localhost:3001
# æˆ–
http://auth.localhost:3001

# æµ‹è¯•ç‚¹ï¼š
âœ… ç™»å½•é¡µé¢æ˜¾ç¤º
âœ… æ³¨å†Œé¡µé¢æ˜¾ç¤º
âœ… å¯†ç é‡ç½®æµç¨‹
âœ… å¤šè¯­è¨€åˆ‡æ¢
```

#### 1.3 Dashboard ç«™ç‚¹
```bash
# è®¿é—®åœ°å€
http://localhost:3002
# æˆ–
http://dashboard.localhost:3002

# æµ‹è¯•ç‚¹ï¼š
âœ… æœªç™»å½•æ—¶è·³è½¬åˆ°ç™»å½•é¡µ
âœ… ä»ªè¡¨ç›˜ç•Œé¢
âœ… è®¢é˜…ç®¡ç†é¡µé¢
âœ… ç”¨æˆ·è®¾ç½®é¡µé¢
```

### é˜¶æ®µ2: SSO è·¨ç«™ç‚¹æµ‹è¯•

#### æµ‹è¯•åœºæ™¯1: ä» Dashboard ç™»å½•
```
1. è®¿é—® http://dashboard.localhost:3002
2. åº”è¯¥è·³è½¬åˆ°ç™»å½•é¡µé¢
3. å®Œæˆç™»å½•
4. è¿”å› Dashboard
5. æ‰“å¼€æ–°æ ‡ç­¾é¡µè®¿é—® http://www.localhost:3000
6. âœ… åº”è¯¥çœ‹åˆ°å·²ç™»å½•çŠ¶æ€ï¼ˆå³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼‰
```

#### æµ‹è¯•åœºæ™¯2: ä» Main ç«™ç‚¹ç™»å½•
```
1. è®¿é—® http://www.localhost:3000
2. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
3. è·³è½¬åˆ°ç™»å½•é¡µé¢
4. å®Œæˆç™»å½•åè¿”å›
5. æ‰“å¼€ http://dashboard.localhost:3002
6. âœ… åº”è¯¥ç›´æ¥è¿›å…¥ä»ªè¡¨ç›˜ï¼ˆæ— éœ€å†æ¬¡ç™»å½•ï¼‰
```

#### æµ‹è¯•åœºæ™¯3: ç™»å‡ºåŒæ­¥
```
1. åœ¨ä»»æ„ç«™ç‚¹ç™»å‡º
2. åˆ·æ–°å…¶ä»–ç«™ç‚¹
3. âœ… æ‰€æœ‰ç«™ç‚¹åº”è¯¥éƒ½æ˜¾ç¤ºæœªç™»å½•çŠ¶æ€
```

---

## ğŸ” æ£€æŸ¥ç‚¹

### Cookie æ£€æŸ¥
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Application/Storage â†’ Cookies

åº”è¯¥èƒ½çœ‹åˆ°ï¼š
```
Domain: .localhost
Name: sb-lhofjwiqjqjtycnhliga-auth-token
Path: /
Secure: Yes (HTTPS) / No (HTTP)
SameSite: Lax
```

### æ§åˆ¶å°æ£€æŸ¥
F12 â†’ Consoleï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼š
- âŒ CORS é”™è¯¯
- âŒ 401 è®¤è¯é”™è¯¯
- âŒ Cookie æ— æ³•è®¾ç½®

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: Cookie æ— æ³•è·¨ç«™ç‚¹å…±äº«

**ç—‡çŠ¶**: åœ¨ Dashboard ç™»å½•åï¼ŒMain ç«™ç‚¹ä»æ˜¾ç¤ºæœªç™»å½•

**åŸå› **: æµè§ˆå™¨ä¸æ”¯æŒ `.localhost` ä½œä¸º Cookie åŸŸ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆA: ä¿®æ”¹ hosts æ–‡ä»¶
sudo vim /etc/hosts

# æ·»åŠ ï¼š
127.0.0.1 auth.wizpulseai.local
127.0.0.1 dashboard.wizpulseai.local
127.0.0.1 www.wizpulseai.local

# ç„¶åä¿®æ”¹å„ç«™ç‚¹ .env.local
NEXT_PUBLIC_COOKIE_DOMAIN=.wizpulseai.local

# è®¿é—®åœ°å€æ”¹ä¸ºï¼š
# http://auth.wizpulseai.local:3001
# http://dashboard.wizpulseai.local:3002
# http://www.wizpulseai.local:3000
```

### é—®é¢˜2: ç«¯å£å·²è¢«å ç”¨

**ç—‡çŠ¶**: `Error: listen EADDRINUSE: address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3001
lsof -i :3002
lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä½¿ç”¨ä¸åŒç«¯å£
npm run dev -- -p 3003
```

### é—®é¢˜3: Supabase è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º `Failed to fetch` æˆ– 401 é”™è¯¯

**æ£€æŸ¥æ¸…å•**:
```bash
# 1. éªŒè¯ Supabase URL å’Œ Key
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY

# 2. æµ‹è¯• Supabase è¿æ¥
curl https://lhofjwiqjqjtycnhliga.supabase.co/rest/v1/

# 3. æ£€æŸ¥ Supabase é¡¹ç›®çŠ¶æ€
# ç™»å½• https://app.supabase.com
# æŸ¥çœ‹é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œ
```

### é—®é¢˜4: ä¾èµ–å®‰è£…é—®é¢˜

**ç—‡çŠ¶**: å¯åŠ¨æ—¶æŠ¥ Module not found

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ é™¤ node_modules å’Œ lock æ–‡ä»¶
rm -rf node_modules package-lock.json
rm -rf .next

# é‡æ–°å®‰è£…
npm install

# æˆ–ä½¿ç”¨ pnpm
pnpm install
```

---

## ğŸ“Š æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

#### Auth ç«™ç‚¹
- [ ] ç”¨æˆ·æ³¨å†Œ
- [ ] é‚®ç®±ç™»å½•
- [ ] Google OAuth ç™»å½•
- [ ] å¯†ç é‡ç½®
- [ ] é‚®ç®±éªŒè¯
- [ ] å¤šè¯­è¨€åˆ‡æ¢

#### Dashboard ç«™ç‚¹
- [ ] æœªç™»å½•è·³è½¬
- [ ] ç™»å½•åè®¿é—®ä»ªè¡¨ç›˜
- [ ] æŸ¥çœ‹è®¢é˜…ä¿¡æ¯
- [ ] æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
- [ ] ä¿®æ”¹ç”¨æˆ·èµ„æ–™
- [ ] ç®¡ç†å‘˜åŠŸèƒ½ï¼ˆå¦‚æœæœ‰ç®¡ç†å‘˜è´¦å·ï¼‰

#### Main ç«™ç‚¹
- [ ] é¦–é¡µæµè§ˆ
- [ ] äº§å“é¡µé¢
- [ ] çŸ¥è¯†ä¸­å¿ƒ
- [ ] ç™»å½•/ç™»å‡º
- [ ] å¤šè¯­è¨€åˆ‡æ¢
- [ ] 3D åŠ¨ç”»åŠ è½½

#### SSO æµ‹è¯•
- [ ] Dashboard â†’ Main ç™»å½•åŒæ­¥
- [ ] Main â†’ Dashboard ç™»å½•åŒæ­¥
- [ ] ç™»å‡ºåŒæ­¥
- [ ] Cookie æ­£ç¡®è®¾ç½®
- [ ] åˆ·æ–°é¡µé¢ä¿æŒç™»å½•

### æ€§èƒ½æµ‹è¯•
- [ ] é¦–å±åŠ è½½æ—¶é—´ < 3ç§’
- [ ] é¡µé¢è·³è½¬æµç•…
- [ ] æ— æ˜æ˜¾çš„ç™½å±/é—ªçƒ
- [ ] æ§åˆ¶å°æ— é”™è¯¯

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³ä»»åŠ¡ (P0)
1. âœ… å®Œæˆæœ¬åœ°æµ‹è¯•
2. ğŸ”² ä¿®å¤å‘ç°çš„é—®é¢˜
3. ğŸ”² ç¡®è®¤ SSO æµç¨‹æ­£å¸¸

### çŸ­æœŸä»»åŠ¡ (P1)
1. ğŸ”² ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆå‡å°‘é¡µé¢é—ªçƒï¼‰
2. ğŸ”² æ·»åŠ äº§å“è¯•ç”¨åŠŸèƒ½
3. ğŸ”² å®Œå–„ä½¿ç”¨ç»Ÿè®¡å±•ç¤º

### ä¸­æœŸä»»åŠ¡ (P2)
1. ğŸ”² Stripe æ”¯ä»˜æµç¨‹å®Œæ•´æµ‹è¯•
2. ğŸ”² API å¼€æ”¾å¹³å°å¼€å‘
3. ğŸ”² å¼€å‘è€…æ–‡æ¡£ç¼–å†™

### é•¿æœŸä»»åŠ¡ (P3)
1. ğŸ”² ä¼ä¸šåŠŸèƒ½å¼€å‘
2. ğŸ”² æ€§èƒ½ä¼˜åŒ–
3. ğŸ”² å›½é™…åŒ–æ‰©å±•

---

## ğŸ“ è®°å½•æµ‹è¯•ç»“æœ

### æµ‹è¯•æ—¥æœŸ: ___________

#### å‘ç°çš„é—®é¢˜
1.
2.
3.

#### éœ€è¦ä¼˜åŒ–çš„ç‚¹
1.
2.
3.

#### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1.
2.
3.

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

- ğŸ“§ è”ç³»å¼€å‘å›¢é˜Ÿ
- ğŸ“š æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£: `/wizPulseAI-docs/`
- ğŸ¤– å’¨è¯¢ AI åŠ©æ‰‹ï¼ˆæ›´æ–° CLAUDE.mdï¼‰

